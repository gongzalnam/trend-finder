<!-- =========================================
     í”„ëŸ°íŠ¸ (ì •ì , GitHub Pagesìš© index.html)
     ========================================= -->
<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Trend Finder â€” ì˜¨ë””ë§¨ë“œ</title>
<style>
:root{--bg:#0f172a;--panel:#111827;--muted:#9ca3af;--fg:#e5e7eb;--pri:#1f2937;--acc:#0ea5e9}
body{margin:0;background:#0b1220;font-family:system-ui,pretendard,Segoe UI,malgun gothic,sans-serif;color:#e5e7eb}
.wrap{max-width:900px;margin:24px auto;padding:0 16px}
.card{background:#0f172a;border:1px solid #172033;border-radius:14px;padding:16px}
h1{font-size:20px;margin:16px 0}
.group{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.tabs{display:flex;background:#0b1220;border:1px solid #23314d;border-radius:10px;overflow:hidden}
.tab{flex:1;padding:10px 12px;text-align:center;cursor:pointer;color:#cbd5e1}
.tab.active{background:#1e293b;color:#fff;font-weight:700}
label{display:block;font-size:12px;color:#93a4bf;margin:8px 2px}
input,select{width:100%;padding:10px;border:1px solid #23314d;border-radius:10px;background:#0b1220;color:#e5e7eb}
.btn{padding:10px 14px;border-radius:10px;border:1px solid #264161;background:#0d2037;color:#e5e7eb;cursor:pointer}
.btn.primary{background:#065f46;border-color:#0d9488}
.kbd{opacity:.8}
.table{width:100%;border-collapse:collapse;margin-top:14px;font-size:14px}
th,td{border-bottom:1px solid #1f2a44;padding:10px}
th{text-align:left;color:#9fb4d1}
.right{text-align:right}
.badge{padding:2px 8px;border-radius:999px;background:#13253d;color:#9fb4d1;font-size:12px}
.muted{color:#9fb4d1}
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.chip{padding:6px 10px;border-radius:999px;background:#13253d;color:#cfe1ff;border:1px solid #274266;cursor:pointer}
</style>

<div class="wrap">
  <h1>Trend Finder â€” ê²€ìƒ‰í˜•</h1>
  <div class="card">
    <label>ê²€ìƒ‰ ì„¤ì •</label>
    <div class="tabs" id="tabs">
      <div class="tab active" data-mode="keyword">í‚¤ì›Œë“œ</div>
      <div class="tab" data-mode="channel">ì±„ë„</div>
      <div class="tab" data-mode="category">ì¹´í…Œê³ ë¦¬</div>
    </div>

    <div id="panel-keyword" class="panel">
      <label>ê²€ìƒ‰ í‚¤ì›Œë“œ</label>
      <input id="kw-term" placeholder="ì˜ˆ: ë‹¹ë‡¨ ì‹ë‹¨, ê°€êµ¬ ë¦¬í¼">
      <div class="row">
        <div style="flex:1">
          <label>íƒœê·¸ ê²€ìƒ‰ ì„¤ì •</label>
          <select id="kw-tagmode">
            <option value="keyword" selected>í‚¤ì›Œë“œ ê²€ìƒ‰</option>
            <option value="tag-in">íƒœê·¸ í¬í•¨</option>
            <option value="tag-only">íƒœê·¸ë§Œ ê²€ìƒ‰</option>
          </select>
        </div>
        <div style="flex:1">
          <label>ì˜ìƒ ë¼ì´ì„ ìŠ¤</label>
          <select id="license">
            <option value="all">ì „ì²´</option>
            <option value="youtube">í‘œì¤€ ë¼ì´ì„ ìŠ¤</option>
            <option value="creativeCommon">í¬ë¦¬ì—ì´í‹°ë¸Œ ì»¤ë¨¼ì¦ˆ</option>
          </select>
        </div>
      </div>
    </div>

    <div id="panel-channel" class="panel" style="display:none">
      <label>ì±„ë„ ID ë˜ëŠ” ì´ë¦„</label>
      <input id="ch-term" placeholder="ì˜ˆ: ì¹¨ì°©ë§¨">
      <label>ì±„ë„ ê²€ìƒ‰ ë°©ì‹</label>
      <div class="row">
        <button class="btn" id="mode-ch" data-chmode="channel">ì±„ë„ëª…ìœ¼ë¡œ ì±„ë„ ê²€ìƒ‰</button>
        <button class="btn" id="mode-chv" data-chmode="video">ì±„ë„ëª…ìœ¼ë¡œ ì˜ìƒ ê²€ìƒ‰</button>
      </div>
    </div>

    <div id="panel-category" class="panel" style="display:none">
      <label>ì¹´í…Œê³ ë¦¬</label>
      <select id="cat-id">
        <option value="all">ëª¨ë“  ì¹´í…Œê³ ë¦¬</option>
        <option value="10">ìŒì•…</option>
        <option value="17">ìŠ¤í¬ì¸ </option>
        <option value="20">ê²Œì„</option>
        <option value="22">ì¸ë¬¼&ë¸”ë¡œê·¸</option>
        <option value="24">ì—”í„°í…Œì¸ë¨¼íŠ¸</option>
        <option value="25">ë‰´ìŠ¤&ì •ì¹˜</option>
        <option value="26">ë…¸í•˜ìš°&ìŠ¤íƒ€ì¼</option>
        <option value="27">êµìœ¡</option>
        <option value="28">ê³¼í•™&ê¸°ìˆ </option>
      </select>
      <label>í•µì‹¬ í‚¤ì›Œë“œ(ì„ íƒ)</label>
      <input id="cat-core" placeholder="ì˜ˆ: ì‹œë‹ˆì–´, ë…¸í›„, ì‚¬ì—°">
    </div>

    <label>ì •ë ¬ Â· ê²°ê³¼ ìˆ˜</label>
    <div class="row">
      <select id="order">
        <option value="viewCount" selected>ì¡°íšŒìˆ˜</option>
        <option value="date">ì—…ë¡œë“œ ìµœì‹ </option>
        <option value="relevance">ê´€ë ¨ì„±</option>
      </select>
      <select id="limit">
        <option value="50">ê¸°ë³¸ (50ê°œ)</option>
        <option value="30">30ê°œ</option>
        <option value="20">20ê°œ</option>
        <option value="10">10ê°œ</option>
      </select>
      <select id="sort">
        <option value="score">ì ìˆ˜</option>
        <option value="vph">VPH</option>
        <option value="views">ì¡°íšŒìˆ˜</option>
        <option value="likeRate">ì¢‹ì•„ìš”ìœ¨</option>
        <option value="cph">ëŒ“ê¸€/ì‹œê°„</option>
      </select>
    </div>

    <label>í•„í„° ì„¤ì •</label>
    <div class="group">
      <div>
        <label>ì˜ìƒ ê¸¸ì´</label>
        <select id="duration">
          <option value="any">ëª¨ë“  ê¸¸ì´</option>
          <option value="short">ì§§ìŒ (&lt;4ë¶„)</option>
          <option value="medium">ì¤‘ê°„ (4~20ë¶„)</option>
          <option value="long">ê¹€ (&gt;20ë¶„)</option>
        </select>
      </div>
      <div>
        <label>ê¸°ê°„</label>
        <select id="period">
          <option value="24h">í•˜ë£¨ ì „</option>
          <option value="48h">ì´í‹€ ì „</option>
          <option value="72h">3ì¼ ì „</option>
          <option value="7d">í•œ ì£¼ ì „</option>
          <option value="1m" selected>í•œ ë‹¬ ì „</option>
        </select>
      </div>
      <div>
        <label>êµ­ê°€</label>
        <select id="region">
          <option value="KR" selected>í•œêµ­</option>
          <option value="US">ë¯¸êµ­</option>
          <option value="JP">ì¼ë³¸</option>
          <option value="GB">ì˜êµ­</option>
          <option value="DE">ë…ì¼</option>
        </select>
      </div>
      <div>
        <label>ìµœì†Œ ì¡°íšŒìˆ˜</label>
        <input id="minViews" value="10000">
        <div class="chips">
          <div class="chip" data-v="100">100+</div>
          <div class="chip" data-v="1000">1ì²œ+</div>
          <div class="chip" data-v="10000">1ë§Œ+</div>
          <div class="chip" data-v="100000">10ë§Œ+</div>
          <div class="chip" data-v="300000">30ë§Œ+</div>
          <div class="chip" data-v="500000">50ë§Œ+</div>
          <div class="chip" data-v="1000000">100ë§Œ+</div>
        </div>
      </div>
    </div>

    <label>ì œì™¸ í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
    <input id="exclude" placeholder="ì˜ˆ: íŠœí† ë¦¬ì–¼, shorts">

    <div class="row" style="margin-top:12px">
      <button class="btn" id="btnRun"><span class="kbd">ğŸ” ê²€ìƒ‰ (Ctrl+Enter)</span></button>
      <button class="btn" id="btnReset" style="margin-left:auto;background:#3f1f20;border-color:#6b1d22">í•„í„° ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <div id="meta" class="muted">ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</div>
    <table class="table">
      <thead><tr>
        <th>ì œëª©</th><th class="right">VPH</th><th class="right">ì¢‹ì•„ìš”ìœ¨</th>
        <th class="right">ëŒ“ê¸€/ì‹œê°„</th><th class="right">ì ìˆ˜</th><th></th>
      </tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>

<script>
const WEBAPP = 'https://script.google.com/macros/s/AKfycbzHtAOeX8S3V1F9JtmYtDkabk54bhubexI54HkLk_EUM5GnFRtaeljBpNUQiZ_bbu0m/exec
let currentMode = 'keyword';
let channelSearchMode = 'channel'; // 'channel' | 'video'

document.querySelectorAll('#tabs .tab').forEach(tab=>{
  tab.onclick = ()=>{
    document.querySelectorAll('#tabs .tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    currentMode = tab.dataset.mode;
    document.getElementById('panel-keyword').style.display = currentMode==='keyword'?'block':'none';
    document.getElementById('panel-channel').style.display = currentMode==='channel'?'block':'none';
    document.getElementById('panel-category').style.display = currentMode==='category'?'block':'none';
  };
});
document.getElementById('mode-ch').onclick = ()=>{ channelSearchMode='channel'; alert('ì±„ë„ëª…ìœ¼ë¡œ ì±„ë„ ê²€ìƒ‰ ëª¨ë“œ'); };
document.getElementById('mode-chv').onclick = ()=>{ channelSearchMode='video'; alert('ì±„ë„ëª…ìœ¼ë¡œ ì˜ìƒ ê²€ìƒ‰ ëª¨ë“œ'); };

document.querySelectorAll('.chip').forEach(c=>{
  c.onclick=()=>{ document.getElementById('minViews').value = c.dataset.v; };
});
document.getElementById('btnReset').onclick = ()=>{
  document.getElementById('duration').value='any';
  document.getElementById('period').value='1m';
  document.getElementById('region').value='KR';
  document.getElementById('minViews').value='10000';
  document.getElementById('exclude').value='';
  document.getElementById('order').value='viewCount';
  document.getElementById('limit').value='50';
  document.getElementById('sort').value='score';
  document.getElementById('license').value='all';
};

async function run(){
  const params = new URLSearchParams();
  params.set('mode', currentMode);
  params.set('order', document.getElementById('order').value);
  params.set('period', document.getElementById('period').value);
  params.set('region', document.getElementById('region').value);
  params.set('duration', document.getElementById('duration').value);
  params.set('limit', document.getElementById('limit').value);
  params.set('sort', document.getElementById('sort').value);
  params.set('minViews', document.getElementById('minViews').value);
  params.set('exclude', document.getElementById('exclude').value);
  params.set('license', document.getElementById('license').value);

  if (currentMode==='keyword'){
    let term = document.getElementById('kw-term').value.trim();
    const tagmode = document.getElementById('kw-tagmode').value;
    if (!term){ alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
    // íƒœê·¸ ëª¨ë“œ: ê°„ë‹¨ êµ¬í˜„ â€” tag-onlyëŠ” íƒœê·¸ ê²€ìƒ‰ì‹ìœ¼ë¡œ hint
    if (tagmode==='tag-only') term = `#${term}`;
    params.set('term', term);
    // tag-in ì€ ì‚¬í›„ í•„í„° excludeë¡œ ì²˜ë¦¬ ê°€ëŠ¥(ë‹¨ìˆœí™”). í•„ìš” ì‹œ ë°±ì—”ë“œ í™•ì¥.
  }
  if (currentMode==='channel'){
    const term = document.getElementById('ch-term').value.trim();
    if (!term){ alert('ì±„ë„ëª…/IDë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
    params.set('term', term);
    params.set('searchMode', channelSearchMode);
  }
  if (currentMode==='category'){
    params.set('categoryId', document.getElementById('cat-id').value);
    params.set('core', document.getElementById('cat-core').value.trim());
  }

  const url = `${WEBAPP}?${params.toString()}`;
  const meta = document.getElementById('meta');
  meta.textContent = 'ì¡°íšŒ ì¤‘â€¦';
  const res = await fetch(url);
  const data = await res.json();
  if (!data.ok){ meta.textContent = data.error || 'ì˜¤ë¥˜'; return; }

  const rows = data.items || [];
  meta.innerHTML = `ëª¨ë“œ: <span class="badge">${data.mode}</span>
    Â· ê²°ê³¼: <span class="badge">${rows.length}</span>
    ${data.channel ? `Â· ì±„ë„: <span class="badge">${data.channel.channelTitle}</span>` : ''}`;

  const tb = document.getElementById('rows');
  tb.innerHTML='';
  for(const r of rows){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>
        <div style="font-weight:700">${r.title}</div>
        <div class="muted">${r.channelTitle}</div>
      </td>
      <td class="right">${Number(r.vph||0).toLocaleString()}</td>
      <td class="right">${((Number(r.likeRate||0))*100).toFixed(2)}%</td>
      <td class="right">${r.cph}</td>
      <td class="right" style="font-weight:700">${Number(r.score||0).toLocaleString()}</td>
      <td class="right"><a class="badge" href="${r.url}" target="_blank">ë³´ê¸°</a></td>`;
    tb.appendChild(tr);
  }
}

document.getElementById('btnRun').onclick = run;
document.addEventListener('keydown', (e)=>{
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') run();
});
</script>
